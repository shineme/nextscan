# 产品需求文档 (PRD)

## 一、项目概述

* **项目名称**：在线信息探测系统
* **目标用户**：内部技术团队（安全、运维、开发等）
* **产品目标**：自动化探测大量域名上是否存在特定文件，保存探测结果，方便后续分析。

## 二、功能清单

1. **任务管理**

   * 创建和管理探测任务
   * 任务状态跟踪（运行中、已完成、失败等）
   * 任务结果查看与统计

2. **增量探测**

   * 每日自动拉取最新的 CSV 域名列表
   * 对比新出现的域名，进行增量探测

3. **半年复扫**

   * 每六个月对所有历史域名进行完全扫描
   * 结果与历史记录保留，便于追踪变化

4. **URL 组合与探测**

   * 支持灵活的 URL 路径模板配置
   * 支持多种占位符以生成不同的 URL

5. **结果存储与分析**

   * 记录每个域名探测的结果，保留所有历史记录
   * 提供结果导出功能

## 三、核心流程

1. **域名列表获取**

   * 从固定的远程 CSV 地址定期拉取域名列表
   * 任务完成后进行增量域名探测

2. **URL 生成**

   * 根据配置的路径模板与占位符生成 URL
   * 支持自定义路径模板和占位符

3. **探测逻辑**

   * 将生成的 URL 按批推送到 Cloudflare Workers
   * 处理请求结果并入库

## 四、接口设计

* **任务管理接口**

  * 创建任务
  * 查询任务状态
  * 获取任务结果

* **探测结果接口**

  * 接收 Cloudflare Workers 的探测结果
  * 查询特定域名的探测历史记录

## 五、数据结构

1. **domains** 表

   * `id`
   * `domain`
   * `first\_seen\_at`
   * `last\_seen\_in\_csv\_at`
   * `has\_been\_scanned`

2. **scan\_tasks** 表

   * `id`
   * `type`（增量 / 半年复扫）
   * `csv\_version`
   * `status`
   * `total\_domains`
   * `new\_domains\_count`
   * `created\_at`
   * `finished\_at`

3. **scan\_results** 表

   * `id`
   * `task\_id`
   * `domain\_id`
   * `url`
   * `status\_code`
   * `content\_type`
   * `content\_length`
   * `checked\_at`

## 六、URL 模板与占位符

### 1\. 路径模板示例

* `1.zip`
* `files.zip`
* `(domain).zip`
* `(root\_domain).zip`
* `(subdomain)\_(year).zip`

### 2\. 支持的占位符

| 占位符       | 含义                         | 示例输入                         | 替换后                   |
|--------------|------------------------------|----------------------------------|--------------------------|
| `(host)`     | 完整 host                    | `sub1.sub2.example.co.uk`       | `sub1.sub2.example.co.uk` |
| `(root\_domain)` | 主域名（注册域）          | `sub1.sub2.example.co.uk`       | `example.co.uk`          |
| `(subdomain)`| 子域名部分（可为空）        | `sub1.sub2.example.co.uk`       | `sub1.sub2`              |
| `(tld)`      | 顶级域                       | `sub1.sub2.example.co.uk`       | `co.uk`                  |
| `(sld)`      | 二级域（主域名主体，不含 TLD） | `www.google.com`             | `google`                 |
| `(year)`     | 年（4 位）                  | `2025-11-24`                    | `2025`                   |
| `(month)`    | 月（2 位）                  | `2025-11-24`                    | `11`                     |
| `(day)`      | 日（2 位）                  | `2025-11-24`                    | `24`                     |
| `(ymd)`      | 年月日（紧凑）              | `2025-11-24`                    | `20251124`               |
| `(date)`     | 等价于 `(ymd)`              | `2025-11-24`                    | `20251124`               |
| `(date\_dash)`| 年-月-日                    | `2025-11-24`                    | `2025-11-24`             |
| `(timestamp)`| 秒级时间戳（可选）         | `2025-11-24 00:00:00 UTC`      | `1732406400`             |
| `(rank)`     | CSV 排名                     | 第 42 名                        | `42`                     |
| `(csv\_date)` | CSV 日期                    | `2025-11-24`                    | `20251124`               |

## 七、非功能需求

* **性能**：每轮增量探测任务应在指定时间内（如 1 小时内）完成。
* **安全性**：确保数据传输过程中的安全措施，避免泄露敏感信息。
* **可扩展性**：系统应支持后续功能扩展，如增加新的探测路径模板、新的统计分析功能等。

## 八、后续计划

* **开发计划**：预计开发周期为 3 个月，分阶段进行功能开发与测试。
* **用户反馈**：上线后收集用户反馈，持续改进系统功能和用户体验。

---

# 前端功能总结

## 1\. 登录

* 登录页面

## 2\. 总览页 / Dashboard

* 当前任务概况（进行中的任务、最近任务状态统计）
* 简单统计（累计已知域名数、命中文件数、状态码分布）

## 3\. 任务管理页

### 3.1 任务列表页

* 任务 ID / 名称 / 类型 / 状态 / 进度 / 开始 / 完成时间
* 筛选和排序功能

### 3.2 新建任务页（或弹窗）

* 基本信息（任务名称、任务类型）
* 域名集合选择（增量/复扫）
* URL 模板配置（协议选择、路径模板）
* 执行参数（并发数量、请求超时、重试次数）

### 3.3 任务详情页

* 任务基本信息展示
* 执行进度与统计（状态码分布、命中文件数量）
* 结果预览（概要展示、筛选功能）

## 4\. 域名维度的页面

### 4.1 域名列表页

* 域名基本信息（首次出现、是否已探测）
* 筛选功能（按域名关键字、未探测域名）

### 4.2 域名详情页

* 域名基本信息展示
* 历史探测记录（时间线）

## 5\. 结果查询页 / 高级筛选

* 条件筛选功能（时间范围、状态码、域名关键词等）
* 结果表格展示（域名、URL、状态码、任务信息）
* 导出当前筛选结果为 CSV

## 6\. 配置页（系统设置）

* CSV 配置（远程地址、拉取方式）
* Worker 配置（endpoint 列表、最大并发数）
* 子域名探测设置（是否开启、是否加入列表、泛解析判断）
